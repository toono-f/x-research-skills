# 深掘りリサーチ: Claude Codeを止まらない自律エージェントとして運用する方法（コンテナ内無限ループハーネス、並列git同期、context汚染対策）

## Meta
- Timestamp (UTC): 2026-02-13T23:02:31.288Z
- Topic: Claude Codeを止まらない自律エージェントとして運用する方法（コンテナ内無限ループハーネス、並列git同期、context汚染対策）
- Locale: ja
- Window: 168h

---

## テーマ
Claude Codeをコンテナ内で無限ループハーネス化し、並列git同期とcontext汚染対策を施した止まらない自律エージェントとして運用するための技術構造と実装知見を理解するためのリサーチ（As of 2026-02-13）。

## 技術的ファクト
- Claude CodeはAnthropicのターミナルベースコーディングエージェントCLIツール。ファイル編集、git操作、ターミナルコマンド実行が可能。Pro plan $20/mo、Max $200/mo存在。rate limitが厳しく、Proで30分以内にhitする報告多数（https://code.claude.com/docs/en/costs, As of 2026-02-13）。
- Agent Teams機能（research preview）：CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1で有効。リードエージェントが複数メンバーエージェントをspawnし、並列作業。共有タスクリストとメールボックスで通信。各エージェント独立context。トークン消費7倍（https://www.anthropic.com/news/claude-opus-4-6, As of 2026-02-13）。
- コンテキスト管理：CLAUDE.mdは150行以内に制限推奨。/compactで50%使用時に圧縮、/clearでリセット。context window 100万トークン（Opus 4.6ベータ）。（https://code.claude.com/docs, As of 2026-02-13）。
- Docker対応：Docker Model Runnerでオープンソースモデル使用しローカル実行可能。devcontainer/remote setup対応（https://www.docker.com/blog/run-claude-code-locally-docker-model-runner/, https://plannotator.ai/, As of 2026-02-13）。
- GitHub stats：公開コミットの4%をClaude Code生成。2026年末20%超予測（https://newsletter.semianalysis.com/p/claude-code-is-the-inflection-point, As of 2026-02-13）。

## アーキテクチャ / 仕組み
- **コア構造**:
  - Claude Codeインスタンス：単一エージェント（メイン）またはAgent Teams（リード + メンバー複数）。
  - ハーネス層：skills/slash commandsでラップ（例: /security-review, /sync）。外部ツール（Slack/Linear/git）アクセス。
  - コンテナ化：Docker/devcontainerで隔離実行。無限ループはcron/watchdogスクリプトでセッション再起動。
  - 並列git：複数git worktree（za/zb/zc alias）で並列インスタンス。同期はgit pull/push。
  - context対策：subagentsでサブタスクオフロード、OneContextで永続context共有、/compact自動化。
- **無限ループフロー**:
  1. コンテナ起動 → Claude Code spawn。
  2. タスク監視ループ（タスクリスト共有）。
  3. rate limit hit → /clear + re-spawn。
  4. git同期（worktree merge）。

## 実装・活用例

### 例1: Agent Teams有効化で並列自律運用
- 概要: settings.jsonに"CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"追加。リードがチームspawnし、共有タスクリストで協業。トークン高消費だが並列でcontext汚染低減。In-process/split panes（tmux/iTerm2）モード。
- 情報源: https://x.com/oikon48/status/2019483180525580472
- 再現するなら: 1. env varセット、2. tmux new-session -s team、3. "build API with team"プロンプト。

### 例2: Dockerローカル + devcontainerハーネス（plannotator）
- 概要: Docker Model RunnerでClaude Codeローカル実行。plannotatorで計画アノテーション/共有。devcontainerでremote setup、self-host share portal。
- 情報源: https://github.com/backnotprop/plannotator/releases/tag/v0.8.0, https://plannotator.ai/
- 再現するなら: 1. docker run model-runner claude-code、2. PLANNOTATOR_SHARE_URLセット、3. /plannotator-annotate spec.md。

### 例3: 並列git worktree + context管理
- 概要: git worktree add ../proj-aで複数tree。alias za="cd ../proj-a && zsh -c claude-code"。CLAUDE.md短く保ち、/compact 50%で実行。OneContextで永続。
- 情報源: https://x.com/0x__tom/status/2021761936007073965, https://github.com/The-Vibe-Company/onecontext-ai
- 再現するなら: 1. git worktree add -b branch-a ../a、2. alias設定~/.zshrc、3. npm i -g onecontext-ai && onecontext。

## トレードオフ・制約

### 制限事項
- rate limit厳格：Pro $20/moで"sustained agentic tasks"不可、reset 12-24h。3rd party harnessでfraud検知（https://x.com/trq212/status/2009802192484741181）。
- トークン消費：Agent Teams 7倍、100万トークン $5 input/$25 output（超過$10/$37.5）。
- 環境：tmux/iTerm2必須 for split panes。コンテナgeo-tag稀（https://code.claude.com/docs/en/costs）。
- 既知バグ：auto-compact遅延、非同期subagentでcontext overflow（/clear必須）（https://x.com/hiragram/status/2020701941345697917）。

### 代替手段との比較
| 観点 | Claude Code | Codex (OpenAI) | OpenCode |
|---|---|---|---|
| rate limit | 厳格 (Pro 30min hit) | 緩和 ($20/mo無制限報告) | unknown |
| Agent Teams | 並列共有タスクリスト | なし (sequential) | 基本サポート |
| コンテナ対応 | Docker Model Runner優秀 | 限定的 | OSSフル |
| context耐久 | /compact + OneContext必要 | 自然耐性高 | 低消費 |
| 価格 | $20-200/mo | $20/mo | 無料ローカル |

## エンジニアの実践知見
- 並列worktreeで待ち時間0：開発チーム3-5 tree同時運用。分析専用treeでログ/BigQuery分離（https://x.com/0x__tom/status/2021761936007073965）。
- context汚染回避：subagents必須、"use subagents"追加でメイン汚染0。CLAUDE.md 150行超で無視（https://x.com/lettuce908/status/2021761936007073965）。
- ハマり：Agent Teams spawn自動選択不適切 → spawning-plan-skillで計画先行（npx skills add octaviusp/spawning-plan-skill）。rate limit → Codex fallback（https://x.com/octaviopvn1/status/2020365772065829155）。
- ワークアラウンド：Ghosttyターミナル + 音声入力でプロンプト詳細化。notes.md再帰更新でミス低減。

## 未踏の角度（まだ誰も検証していないこと）
- コンテナ内cronハーネス + rate limit proxy：Dockerでセッション監視/再spawnスクリプト。価値：Pro plan内無限運用実現、$200/day回避（OSS controller基盤化未）。
- Agent Teams + 並列worktree git-sync自動化：共有タスクリストをgit hook連携。価値：multi-day drift防止、GitHub 20%コミット目標達成加速。
- long-run context compaction with OneContext + Capsule：100+セッション汚染耐性テスト。価値：ベンチ未計測のcontext durability定量化、本番エンタープライズ移行鍵。

## エンジニアとしてのアクション
- 今すぐ試せる：1. Claude Pro加入、2. settings.jsonにAgent Teams env追加、3. git worktree add ../test-a && cd ../test-a && claude-code "plan team for app"。
- 発信差別化：コンテナ内無限ループハーネスPoC（Docker + watchdog）。日本語圏未検証領域で「rate limit突破実測」共有。
